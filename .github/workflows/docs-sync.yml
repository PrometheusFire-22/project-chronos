name: Sync Documentation to Confluence

on:
    push:
        branches:
            - main
            - develop
        paths:
            - "docs/**/*.md"

jobs:
    sync-docs:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v6

            - name: Set up Python
              uses: actions/setup-python@v6
              with:
                  python-version: "3.11"

            - name: Install dependencies
              run: |
                  pip install -e .

            - name: Sync documentation
              env:
                  CONFLUENCE_URL: ${{ secrets.CONFLUENCE_URL }}
                  CONFLUENCE_EMAIL: ${{ secrets.CONFLUENCE_EMAIL }}
                  CONFLUENCE_API_TOKEN: ${{ secrets.CONFLUENCE_API_TOKEN }}
              run: |
                  python scripts/ops/sync_docs.py

            - name: Commit mapping updates
              run: |
                  git config --global user.name 'github-actions[bot]'
                  git config --global user.email 'github-actions[bot]@users.noreply.github.com'
                  git add docs/.confluence-mapping.json
                  git diff --quiet && git diff --staged --quiet || git commit -m "chore(docs): Update Confluence mapping [skip ci]"
                  git push
